// translations.js
const translations = {
  ka: {
    add_to_cart: "კალათში დამატება",
    clear_cart_confirm: "დარწმუნებული ხართ, რომ გსურთ მენიუს გასუფთავება?",
    no_results: "შედეგები არ მოიძებნა",
    search_term: "ძებნის ტერმინი",
    empty_menu: "მენიუ ცარიელია",
    logout_confirm: "დარწმუნებული ხართ, რომ გსურთ გამოსვლა?",
    title: "მაჭახელა - ქართული რესტორანი",
    admin: "ადმინი",
    login: "შესვლა",
    logout: "გამოსვლა",
    add_item: "დამატება",
    clear_cart: "გასუფთავება",
    search_placeholder: "მენიუში ძებნა...",
    all: "ყველა",
    hot_dishes: "ცხელი კერძები",
    cold_dishes: "ცივი კერძები",
    bakery: "ცომეული",
    soups: "წვნიანები",
    desserts: "დესერტი",
    drinks: "სასმელები",
    alcoholic_drinks: "ალკოჰოლური სასმელები",
    your_menu: "თქვენი მენიუ",
    subtotal: "ჯამი",
    service: "სერვისი",
    total: "სულ",
    empty_cart: "თქვენი მენიუ ცარიელია",
    add_items: "დაამატეთ პროდუქტები მენიუდან",
    address: "მაჭახელა 13, ბათუმი",
    wifi: "WiFi: Gourmet_2023",
    password: "PASS: Gourmet_2023",
    description: "ჩვენი რესტორანი მოგაწვდით ტრადიციულ და თანამედროვე ქართულ კერძებს. ყველა პროდუქტი ადგილობრივი ფერმერებისგან არის შერჩეული.",
    working_hours: "ყოველდღე: 10:00 - 23:00",
    admin_panel: "ადმინის პანელი",
    add_new_item: "ახალი პროდუქტის დამატება",
    item_name: "სახელი",
    item_price: "ფასი (₾)",
    item_category: "კატეგორია",
    item_description: "აღწერა",
    item_image: "სურათის URL",
    available: "ხელმისაწვდომია",
    manage_menu: "მენიუს მართვა",
    search_items: "პროდუქტის ძებნა...",
    toggle_on: "ჩართვა",
    toggle_off: "გამორთვა",
    delete: "წაშლა",
    service_management: "სერვისის მართვა",
    service_enabled: "სერვისის ჩართვა",
    service_percentage: "სერვისის პროცენტი (%)",
    save_service: "შენახვა",
    service_fee: "სერვისი",
    static_translations: "სტატიკური ტექსტები",
    menu_item_translations: "მენიუს ელემენტები",
    menu_item: "პროდუქტი",
    translation: "თარგმანი",
    save_translations: "შენახვა",
    auto_translate_all: "ყველა თარგმნა ავტომატურად",
    yes: "დიახ",
    no: "არა",
    cancel: "გაუქმება",
    confirm: "დადასტურება",
    cart_cleared: "მენიუ წარმატებით გასუფთავდა",
    // ... (დანარჩენი თარგმანები)
  },
  en: {
    add_to_cart: "Add to Cart",
    clear_cart_confirm: "Are you sure you want to clear the menu?",
    no_results: "No results found",
    search_term: "Search term",
    empty_menu: "Menu is empty",
    logout_confirm: "Are you sure you want to logout?",
    title: "Machakhela - Georgian Restaurant",
    admin: "Admin",
    login: "Login",
    logout: "Logout",
    add_item: "Add",
    clear_cart: "Clear",
    search_placeholder: "Search menu...",
    all: "All",
    hot_dishes: "Hot Dishes",
    cold_dishes: "Cold Dishes",
    bakery: "Bakery",
    soups: "Soups",
    desserts: "Desserts",
    drinks: "Drinks",
    alcoholic_drinks: "Alcoholic Drinks",
    your_menu: "Your Menu",
    subtotal: "Subtotal",
    service: "Service",
    total: "Total",
    empty_cart: "Your menu is empty",
    add_items: "Add items from menu",
    address: "Machakhela 13, Batumi",
    wifi: "WiFi: Gourmet_2023",
    password: "PASS: Gourmet_2023",
    description: "Our restaurant offers traditional and modern Georgian dishes. All products are selected from local farmers.",
    working_hours: "Daily: 10:00 - 23:00",
    admin_panel: "Admin Panel",
    add_new_item: "Add New Item",
    item_name: "Name",
    item_price: "Price (₾)",
    item_category: "Category",
    item_description: "Description",
    item_image: "Image URL",
    available: "Available",
    manage_menu: "Menu Management",
    search_items: "Search items...",
    toggle_on: "Enable",
    toggle_off: "Disable",
    delete: "Delete",
    service_management: "Service Management",
    service_enabled: "Enable Service",
    service_percentage: "Service Percentage (%)",
    save_service: "Save",
    service_fee: "Service",
    static_translations: "Static Texts",
    menu_item_translations: "Menu Items",
    menu_item: "Product",
    translation: "Translation",
    save_translations: "Save Translations",
    auto_translate_all: "Auto Translate All",
      yes: "Yes",
    no: "No",
    cancel: "Cancel",
    confirm: "confirm",
    cart_cleared: "Menu cleared successfully",
  },
  ru: {
    add_to_cart: "Добавить в корзину",
    clear_cart_confirm: "Вы уверены, что хотите очистить меню?",
    no_results: "Ничего не найдено",
    search_term: "Поисковый запрос",
    empty_menu: "Меню пустое",
    logout_confirm: "Вы уверены, что хотите выйти?",
    title: "Мачахела - Грузинский ресторан",
    admin: "Админ",
    login: "Вход",
    logout: "Выход",
    add_item: "Добавить",
    clear_cart: "Очистить",
    search_placeholder: "Поиск в меню...",
    all: "Все",
    hot_dishes: "Горячие блюда",
    cold_dishes: "Холодные блюда",
    bakery: "Выпечка",
    soups: "Супы",
    desserts: "Десерты",
    drinks: "Напитки",
    alcoholic_drinks: "Алкогольные напитки",
    your_menu: "Ваше меню",
    subtotal: "Подытог",
    service: "Сервис",
    total: "Итого",
    empty_cart: "Ваше меню пустое",
    add_items: "Добавьте блюда из меню",
    address: "Мачахела 13, Батуми",
    wifi: "WiFi: Gourmet_2023",
    password: "ПАРОЛЬ: Gourmet_2023",
    description: "Наш ресторан предлагает традиционные и современные грузинские блюда. Все продукты отобраны у местных фермеров.",
    working_hours: "Ежедневно: 10:00 - 23:00",
    admin_panel: "Админ панель",
    add_new_item: "Добавить новый товар",
    item_name: "Название",
    item_price: "Цена (₾)",
    item_category: "Категория",
    item_description: "Описание",
    item_image: "URL изображения",
    available: "Доступно",
    manage_menu: "Управление меню",
    search_items: "Поиск товаров...",
    toggle_on: "Включить",
    toggle_off: "Выключить",
    delete: "Удалить",
    service_management: "Управление сервисом",
    service_enabled: "Включить сервис",
    service_percentage: "Процент сервиса (%)",
    save_service: "Сохранить",
    service_fee: "Сервис",
    static_translations: "Статические тексты",
    menu_item_translations: "Элементы меню",
    menu_item: "Продукт",
    translation: "Перевод",
    save_translations: "Сохранить переводы",
    auto_translate_all: "Авто Перевод Всех",
     yes: "Да",
    no: "Нет",
    cancel: "Отмена",
    confirm:"подтвердить",
    cart_cleared: "Меню успешно очищено",
  },
  tr: {
    add_to_cart: "Sepete Ekle",
    clear_cart_confirm: "Menüyü temizlemek istediğinizden emin misiniz?",
    no_results: "Sonuç bulunamadı",
    search_term: "Arama terimi",
    empty_menu: "Menü boş",
    logout_confirm: "Çıkış yapmak istediğinizden emin misiniz?",
    title: "Maçakhela - Gürcü Restoranı",
    admin: "Yönetici",
    login: "Giriş",
    logout: "Çıkış",
    add_item: "Ekle",
    clear_cart: "Temizle",
    search_placeholder: "Menüde ara...",
    all: "Tümü",
    hot_dishes: "Sıcak Yemekler",
    cold_dishes: "Soğuk Yemekler",
    bakery: "Fırın Ürünleri",
    soups: "Çorbalar",
    desserts: "Tatlılar",
    drinks: "İçecekler",
    alcoholic_drinks: "Alkollü İçecekler",
    your_menu: "Menünüz",
    subtotal: "Ara Toplam",
    service: "Servis",
    total: "Toplam",
    empty_cart: "Menünüz boş",
    add_items: "Menüden ürün ekleyin",
    address: "Maçakhela 13, Batum",
    wifi: "WiFi: Gourmet_2023",
    password: "ŞİFRE: Gourmet_2023",
    description: "Restoranımız geleneksel ve modern Gürcü yemekleri sunmaktadır. Tüm ürünler yerel çiftçilerden seçilmiştir.",
    working_hours: "Her gün: 10:00 - 23:00",
    admin_panel: "Yönetici Paneli",
    add_new_item: "Yeni Ürün Ekle",
    item_name: "Ad",
    item_price: "Fiyat (₾)",
    item_category: "Kategori",
    item_description: "Açıklama",
    item_image: "Resim URL",
    available: "Mevcut",
    manage_menu: "Menü Yönetimi",
    search_items: "Ürün ara...",
    toggle_on: "Aç",
    toggle_off: "Kapat",
    delete: "Sil",
    service_management: "Servis Yönetimi",
    service_enabled: "Servisi Etkinleştir",
    service_percentage: "Servis Yüzdesi (%)",
    save_service: "Kaydet",
    service_fee: "Servis",
    static_translations: "Statik Metinler",
    menu_item_translations: "Menü Öğelerი",
    menu_item: "Ürün",
    translation: "Çeviri",
    save_translations: "Çevirileri Kaydet",
    auto_translate_all: "Tümünü Otomatik Çevir",
     yes: "Evet",
    no: "Hayır",
    cancel: "İptal",
    confirm:"onayla",
    cart_cleared: "Menü başarıyla temizlendi",
  }
};

// List of brand names that should not be translated
const untranslatableBrands = [
  'Coca-Cola', 'Fanta', 'Sprite', 'Pepsi', 'Lipton', 'Nescafe',
  'კოკა-კოლა', 'ფანტა', 'სპრაიტი', 'პეპსი', 'ლიპტონი', 'ნესკაფე',
  'Кока-Кола', 'Фанта', 'Спрайт', 'Пепси', 'Липтон', 'Нескафе'
];

function isDrinkCategory(itemElement) {
  if (!itemElement) return false;
  
  // Check for menu items
  const categoryElement = itemElement.closest('.menu-category') || 
                         itemElement.closest('.admin-menu-item')?.querySelector('.category');
  
  if (categoryElement) {
    const category = categoryElement.dataset?.category || categoryElement.textContent;
    return category === 'drinks' || category === 'alcoholic_drinks' || 
           category === 'სასმელები' || category === 'ალკოჰოლური სასმელები' ||
           category === 'Drinks' || category === 'Alcoholic Drinks' ||
           category === 'Напитки' || category === 'Алкогольные напитки' ||
           category === 'İçecekler' || category === 'Alkollü İçecekler';
  }
  
  return false;
}

function shouldNotTranslate(text, element) {
  if (!text) return true;
  
  // 1. Check if this is a drink item
  if (element && isDrinkCategory(element)) {
    return true;
  }

  // 2. Check if text contains any brand name
  return untranslatableBrands.some(brand => 
    text.includes(brand) || 
    text.toLowerCase().includes(brand.toLowerCase())
  );
}

function changeLanguage(lang) {
  document.documentElement.lang = lang;
  document.title = translations[lang].title;
  
  const languageSelect = document.querySelector('.language-select');
  if (languageSelect) {
    languageSelect.value = lang;
  }
  
  const adminBtn = document.getElementById('admin-btn');
  if (adminBtn) adminBtn.textContent = translations[lang].admin;
  
  localStorage.setItem('selectedLanguage', lang);
  translatePageContent(lang);
  
  if (document.querySelector('.admin-container')) {
    translateAdminPanel(lang);
  }
}

function translateText(text, lang, element) {
  if (!text || shouldNotTranslate(text, element)) {
    return text;
  }
  
  // Check if this is a menu item name that should be translated
  const menuItems = document.querySelectorAll('.menu-item h3, .admin-menu-item h3');
  for (const item of menuItems) {
    if (item.textContent.trim() === text.trim()) {
      const id = item.closest('.menu-item, .admin-menu-item')?.dataset?.id;
      if (id) {
        const translatedName = firebase.database().ref(`menuItems/${id}/translations/${lang}/name`).once('value');
        if (translatedName && translatedName.val()) {
          return translatedName.val();
        }
      }
    }
  }
  
  return text;
}

function translatePageContent(lang) {
  const t = translations[lang];
  
  // Translate UI elements
  document.querySelectorAll('.filter-btn').forEach(btn => {
    const category = btn.dataset.category;
    btn.textContent = t[category] || category;
  });
  
  const searchInput = document.getElementById('search-input');
  if (searchInput) searchInput.placeholder = t.search_placeholder;
  
  const location = document.querySelector('.location');
  if (location) {
    location.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5 2.5 2.5 0 0 1 0 5z"/>
      </svg>
      ${t.address}
    `;
  }
  
  const wifiElements = document.querySelectorAll('.wifi');
  if (wifiElements.length > 0) {
    wifiElements[0].innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 3C7.31 3 3.36 4.9.29 8.01L12 20.23 23.71 8.01C20.64 4.9 16.69 3 12 3zm0 15.47l-7.18-7.18C6.67 8.85 9.2 7.5 12 7.5c2.8 0 5.33 1.35 7.18 3.79L12 18.47z"/>
      </svg>
      ${t.wifi}
    `;
    
    if (wifiElements.length > 1) {
      wifiElements[1].innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M12 3a5 5 0 0 0-5 5v2H4v12h16V10h-3V8a5 5 0 0 0-5-5zm0 2a3 3 0 0 1 3 3v2H9V8a3 3 0 0 1 3-3zm-4 9h8v2H8v-2z"/>
        </svg>
        ${t.password}
      `;
    }
  }
  
  const info = document.querySelector('.info');
  if (info) info.textContent = t.description;
  
  const spacing = document.querySelector('.spacing');
  if (spacing) spacing.textContent = t.working_hours;
  
  translateCart(lang);
  
  // Translate menu items (except drinks)
  document.querySelectorAll('.menu-item h3').forEach(title => {
    const originalText = title.dataset.originalText || title.textContent;
    title.dataset.originalText = originalText;
    if (!shouldNotTranslate(originalText, title.closest('.menu-item'))) {
      title.textContent = translateText(originalText, lang, title.closest('.menu-item'));
    }
  });
}

function translateCart(lang) {
  const t = translations[lang];
  
  // Translate cart UI elements
  const cartHeader = document.querySelector('.cart-header h2');
  if (cartHeader) cartHeader.textContent = t.your_menu;
  
  const clearCartBtn = document.getElementById('clear-cart');
  if (clearCartBtn) clearCartBtn.textContent = t.clear_cart;
  
  const subtotalLabel = document.querySelector('.summary-label:first-child');
  if (subtotalLabel) subtotalLabel.textContent = t.subtotal;
  
  const serviceLabel = document.querySelector('.service-charge-row .summary-label');
  if (serviceLabel) {
    const percentage = document.getElementById('service-percentage').textContent;
    serviceLabel.innerHTML = `${t.service} (<span id="service-percentage">${percentage}</span>%):`;
  }
  
  const totalLabel = document.querySelector('.total-row .summary-label');
  if (totalLabel) totalLabel.textContent = t.total;
  
  const emptyCart = document.querySelector('.empty-cart');
  if (emptyCart) {
    emptyCart.querySelector('h3').textContent = t.empty_cart;
    emptyCart.querySelector('p').textContent = t.add_items;
  }
  
  // Translate cart items (except drinks)
  document.querySelectorAll('.cart-item-name').forEach(itemName => {
    const originalText = itemName.dataset.originalText || itemName.textContent;
    itemName.dataset.originalText = originalText;
    if (!shouldNotTranslate(originalText, itemName.closest('.cart-item'))) {
      itemName.textContent = translateText(originalText, lang, itemName.closest('.cart-item'));
    }
  });
}

function translateAdminPanel(lang) {
  const t = translations[lang];
  
  // Translate admin UI elements
  const adminPanelTitle = document.querySelector('.admin-header h1');
  if (adminPanelTitle) adminPanelTitle.textContent = t.admin_panel;
  
  const logoutBtn = document.getElementById('logout-btn');
  if (logoutBtn) logoutBtn.textContent = t.logout;
  
  const addItemTitle = document.querySelector('.add-item-form h2');
  if (addItemTitle) addItemTitle.textContent = t.add_new_item;
  
  const formGroups = document.querySelectorAll('.form-group label');
  if (formGroups.length > 0) {
    formGroups[0].textContent = t.item_name + ' (ქართული):';
    formGroups[1].textContent = t.item_price + ':';
    formGroups[2].textContent = t.item_category + ':';
    formGroups[3].textContent = t.item_description + ' (ქართული):';
    formGroups[4].textContent = t.item_image + ':';
  }
  
  const availabilityLabel = document.querySelector('.availability-group label');
  if (availabilityLabel) availabilityLabel.textContent = t.available;
  
  const addBtn = document.querySelector('.add-item-form .btn');
  if (addBtn) addBtn.textContent = t.add_item;
  
  const manageMenuTitle = document.querySelector('.admin-menu .admin-header h2');
  if (manageMenuTitle) manageMenuTitle.textContent = t.manage_menu;
  
  const searchInput = document.getElementById('admin-search-input');
  if (searchInput) searchInput.placeholder = t.search_items;
  
  const serviceTab = document.querySelector('[data-tab="service"]');
  if (serviceTab) serviceTab.textContent = t.service_management;
  
  const serviceTitle = document.querySelector('#service-tab h2');
  if (serviceTitle) serviceTitle.textContent = t.service_management;
  
  const serviceEnabledLabel = document.querySelector('label[for="service-enabled"]');
  if (serviceEnabledLabel) serviceEnabledLabel.textContent = t.service_enabled;
  
  const servicePercentageLabel = document.querySelector('label[for="service-percentage"]');
  if (servicePercentageLabel) servicePercentageLabel.textContent = t.service_percentage;
  
  const saveServiceBtn = document.querySelector('#service-charge-form .btn');
  if (saveServiceBtn) saveServiceBtn.textContent = t.save_service;
  
  const translationsTitle = document.querySelector('#translations-tab h2');
  if (translationsTitle) translationsTitle.textContent = t.translations_management;
  
  const staticTranslationsTitle = document.querySelector('#translations-tab h3');
  if (staticTranslationsTitle) staticTranslationsTitle.textContent = t.static_translations;
  
  const menuItemsTitle = document.querySelector('#translations-tab .translation-section:nth-child(3) h3');
  if (menuItemsTitle) menuItemsTitle.textContent = t.menu_item_translations;
  
  const saveTranslationsBtn = document.getElementById('save-translations');
  if (saveTranslationsBtn) saveTranslationsBtn.textContent = t.save_translations;
  
  const autoTranslateBtn = document.getElementById('auto-translate-all');
  if (autoTranslateBtn) autoTranslateBtn.textContent = t.auto_translate_all;
  
  // Translate admin menu items (except drinks)
  document.querySelectorAll('.admin-menu-item h3').forEach(title => {
    const originalText = title.dataset.originalText || title.textContent;
    title.dataset.originalText = originalText;
    if (!shouldNotTranslate(originalText, title.closest('.admin-menu-item'))) {
      title.textContent = translateText(originalText, lang, title.closest('.admin-menu-item'));
    }
  });
}

function initLanguage() {
  const savedLang = localStorage.getItem('selectedLanguage') || 'ka';
  const languageSelect = document.querySelector('.language-select');
  
  if (languageSelect) {
    languageSelect.value = savedLang;
    
    languageSelect.addEventListener('change', function() {
      const newLang = this.value;
      localStorage.setItem('selectedLanguage', newLang);
      location.reload();
    });
  }
  
  changeLanguage(savedLang);
}

export { changeLanguage, translatePageContent, translateAdminPanel, initLanguage, translations };